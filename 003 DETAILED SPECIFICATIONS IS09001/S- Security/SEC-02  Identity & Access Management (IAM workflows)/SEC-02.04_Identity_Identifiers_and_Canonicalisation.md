# Specification: SEC-02.04 Identity Identifiers & Canonicalisation

| **Document ID** | **Version** | **Status** | **Owner (Author)** | **Approved By** |
|-----------------|-------------|------------|---------------------|------------------|
| **SEC-02.04** | **1.0.0** | **DRAFT** | Business Architect | Product Officer |

---

## 1. Purpose

SEC-02.04 defines the **authoritative standards for identity identifiers** used within the SUSTINA platform for **Identification, Authentication, and Access Management (IAM)**.

This specification governs:
- Which identity identifiers exist and are permitted
- How identifiers are normalised and canonicalised
- How identifiers are stored, protected, and revealed
- How identifiers are used for lookup, uniqueness, and authentication
- GDPR lawful-basis alignment for identifiable data

This document deliberately **does not define hashing or encryption algorithms**.  
Those controls are specified in **SEC-01.01 (Hashing & Irreversible Transformation)** and **SEC-01.02 (Encryption & Key Management)**.

---

## 2. Scope

### 2.1 In Scope
- Human-readable identity identifiers (e.g. email, username)
- Machine identifiers used for IAM (e.g. User GUID, Subject ID)
- Canonicalisation and normalisation rules
- Uniqueness and lookup semantics
- GDPR handling requirements for identifiable data

### 2.2 Out of Scope
- Passwords and secrets (SEC-01.01)
- Encryption primitives and key policy (SEC-01.02)
- Token issuance and sessions (SEC-03.xx)
- Authorisation and role modelling (SEC-04.xx)

---

## 3. Normative Principles

### 3.1 Identifiers Are Not Secrets
Identity identifiers exist to **identify and re-identify a subject**.
They are therefore **readable by design** and must be protected by access control,
not by irreversibility.

### 3.2 Canonical Form Is Authoritative
All identity identifiers must have a **single canonical form** used for:
- Uniqueness checks
- Lookup and matching
- Authentication workflows

Display formats may differ, but canonical values dominate.

### 3.3 Lawful Purpose Required
Each identifier class must have a documented **GDPR lawful basis**
(e.g. contract, legitimate interest).
Identifiers may not be collected or retained without purpose.

### 3.4 Core-Exclusive Identity Logic
Only the **Core API** may:
- Canonicalise identifiers
- Enforce uniqueness
- Perform identity lookups
- Reveal identifiers to authorised callers

---

## 4. Identifier Classes

### 4.1 Primary Identifiers
Primary identifiers uniquely identify a user within SUSTINA.

| Identifier | Description | Notes |
|-----------|-------------|-------|
| User GUID | System-generated immutable identifier | Canonical subject reference |
| Email Address | User-provided contact and login identifier | Must be unique |
| Username | Human-friendly identifier | Optional, unique if enabled |

### 4.2 Secondary Identifiers
Secondary identifiers support communication or enrichment.

Examples:
- Phone number
- External IdP subject identifiers
- Federated account references

Secondary identifiers:
- May be nullable
- Must be explicitly authorised
- Must be encrypted at rest (SEC-01.02)

---

## 5. Canonicalisation Rules

### 5.1 Email Address
- Trim leading/trailing whitespace
- Convert to lowercase
- Apply Unicode normalisation (NFKC)
- Domain treated case-insensitive
- Local-part treated case-insensitive for canonical comparison

### 5.2 Username
- Trim whitespace
- Enforce allowed character set
- Apply Unicode normalisation (NFKC)
- Case-insensitive for uniqueness
- Original casing may be preserved for display

### 5.3 Machine Identifiers
- GUIDs generated by Core API only
- Never reused
- Never derived from personal data

---

## 6. Storage and Protection Requirements

### 6.1 Storage
- Identity identifiers must be stored **encrypted at rest** (SEC-01.02)
- Canonical values stored separately from display values where applicable
- Identifiers must never be stored in plaintext logs

### 6.2 Access Control
- Access to identifiers restricted by role
- Bulk export of identifiers requires explicit approval
- Identifier reveal operations must be auditable

---

## 7. Usage in IAM Workflows

### 7.1 Registration
- Canonicalisation occurs before uniqueness checks
- Duplicate identifiers rejected deterministically

### 7.2 Sign-In
- Lookup performed using canonical identifier
- Display values returned only after authentication

### 7.3 Account Recovery
- Identifier used to locate account
- Responses must be enumeration-safe (SEC-02.02)

---

## 8. GDPR Alignment

- Identifiers classified as **personal data**
- Lawful basis required and documented
- Data minimisation enforced (no unused identifiers)
- Right of access and erasure supported
- Deletion must remove or anonymise identifiers

---

## 9. Logging and Monitoring

- Identifiers must be masked in logs
- Canonical values never logged in full
- Access to identity data must generate audit events

---

## 10. Governance

- Changes require version increment
- New identifier classes require security and GDPR review
- Canonicalisation rule changes require migration plan

---

## 11. Change History

| Version | Date | Author | Notes |
|--------|------|--------|-------|
| 1.0.0 | 2025-12-13 | Business Architect | Initial authoritative IAM identifier specification |
