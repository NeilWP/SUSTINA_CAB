# Data Entity Specification: Z-01.02 CorporateEntity_History

| **Document ID** | **Version** | **Status** | **Owner (Author)** | **Approved By** | **Approved On** |
| :--- | :--- | :--- | :--- | :--- | :--- |
| Z-01.02 | 1.1.0 | **DRAFT** | Business Architect | Product Officer |  |

---

## 1. Description & Scope

The **Z-01.02 CorporateEntity_History** entity provides the immutable, append-only audit history for **Z-01 CorporateEntity**.

It records all **material changes** to the master entity to support:

- ISO9001 and regulatory auditability
- Temporal reconstruction of organisational structure
- Governance oversight of legal and structural changes

---

## 2. Master / Reference / Mapping Role

| Layer | Role |
|-----|-----|
| **Master (Audited)** | Z-01 CorporateEntity |
| **History (Audit)** | Z-01.02 CorporateEntity_History |

---

## 3. Referential Integrity Standard

> Relationships are **logical only**.  
> No physical FOREIGN KEY constraints exist.

Physical tables:
- `[Entity].[CorporateEntity]`
- `[Entity].[CorporateEntity_History]`

---

## 4. Change Capture Policy

The following events **must** write a history record:

| Change Event | ChangeType |
|-------------|-----------|
| Entity creation | CREATE |
| EntityName update | UPDATE_NAME |
| ParentEntityId change | PARENT_CHANGE |
| LegalStatusCode change | LEGAL_STATUS_CHANGE |
| BusinessObjectTypeCode change | OBJECT_TYPE_CHANGE |
| IsActive toggle | ACTIVATE / DEACTIVATE |

Mapping-table changes (Z-01.03, Z-01.05) are **row-audited only** and do not write to this history table.

---

## 5. Table Definition

| Column | Type | Notes |
|------|------|------|
| `HistoryId` | BIGINT IDENTITY | Primary key |
| `CorporateEntityId` | INT | Logical link to Z-01 |
| `ChangeType` | NVARCHAR(50) | Governed change category |
| `ChangeDescription` | NVARCHAR(500) | Human-readable explanation |
| `OldParentEntityId` | INT | Previous hierarchy |
| `NewParentEntityId` | INT | New hierarchy |
| `Snapshot_EntityName` | NVARCHAR(256) | Name at time of change |
| `Snapshot_LegalStatusCode` | NVARCHAR(50) | Legal status snapshot |
| `Snapshot_BusinessObjectTypeCode` | NVARCHAR(50) | Object type snapshot |
| `ChangedBySiteUserGuid` | UNIQUEIDENTIFIER | Who |
| `ChangedByUserName` | NVARCHAR(100) | Display name |
| `ChangedAtUtc` | DATETIME2(3) | When |

---

## 6. Architectural Role

Z-01.02 is the **authoritative audit log** for CorporateEntity master changes and enables full historical reconstruction.

---
